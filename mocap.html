<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <title>BIOLOGIA MOLECULAR - MOCAP</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
  <link href="https://fonts.googleapis.com/css?family=Dosis:400,500|Poppins:400,700&display=swap" rel="stylesheet">
  <link href="css/style.css" rel="stylesheet" />
  <link href="css/responsive.css" rel="stylesheet" />

  <style>
    .mocap-section {
      background: white;
      padding: 15px;
      margin: 10px 0;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .mocap-title {
      color: #21d7ff;
      font-size: 28px;
      margin-bottom: 10px;
      font-weight: bold;
    }
    .info-box {
      background: #f0f8ff;
      border-left: 4px solid #3498db;
      padding: 12px;
      margin: 10px 0;
      border-radius: 4px;
    }
    .info-box h5 {
      color: #2c3e50;
      margin: 0 0 8px 0;
    }
    .info-box p {
      margin: 5px 0;
      font-size: 14px;
      line-height: 1.5;
    }
    .info-box.adn {
      border-left-color: #3498db;
      background: rgba(52, 152, 219, 0.05);
    }
    .info-box.pcr {
      border-left-color: #e74c3c;
      background: rgba(231, 76, 60, 0.05);
    }
    .canvas-container {
      background: white;
      border-radius: 8px;
      padding: 10px;
      margin: 10px 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      text-align: center;
    }
    canvas {
      background: #f8f9fa;
      border-radius: 8px;
      max-width: 100%;
    }
    .controls {
      margin-top: 10px;
      text-align: center;
    }
    .controls button {
      padding: 10px 20px;
      margin: 5px;
      border: none;
      border-radius: 8px;
      background: #21d7ff;
      color: white;
      cursor: pointer;
      font-weight: bold;
      transition: 0.3s;
    }
    .controls button:hover {
      background: #1aa6b7;
    }
    .controls select {
      padding: 10px 15px;
      margin: 5px;
      border: none;
      border-radius: 8px;
      background: #3498db;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    .card-muestra {
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 12px;
      margin: 8px 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
  </style>
</head>

<body>
  <div class="hero_area">
    <header class="header_section">
      <div class="container-fluid">
        <nav class="navbar navbar-expand-lg custom_nav-container ">
          <a class="navbar-brand" href="index.html">
            <img src="images/LOGO_U.png" alt="">
            <span> Universidad Metropolitana </span>
          </a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>

          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <div class="d-flex mx-auto flex-column flex-lg-row align-items-center">
              <ul class="navbar-nav">
                <li class="nav-item">
                  <a class="nav-link" href="index.html">Inicio</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="toma.html">Manual de Procedimientos</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="manual.html">Progreso</a>
                </li>
                <li class="nav-item active">
                  <a class="nav-link" href="mocap.html">MOCAP <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="contactos.html">Contacto</a>
                </li>
              </ul>
            </div>
          </div>
        </nav>
      </div>
    </header>
  

  <div class="container mt-3 mb-3">
    
    <!-- TTULO -->
    <div class="mocap-section">
      <h1 style="color: #3498db; font-weight: bold;" class="mocap-title"><i class="fa fa-dna"></i> An谩lisis ADN: Extracci贸n y Amplificaci贸n por PCR</h1>
      <p style="font-size: 15px; color: #555; line-height: 1.6;">
        Este procedimiento es fundamental en biolog铆a molecular para la detecci贸n y amplificaci贸n de secuencias de ADN espec铆ficas.
      </p>
    </div>

    <!-- PARA QU SIRVE -->
    <div class="mocap-section">
      <h3 style="color: #3498db; margin-bottom: 10px;"><i class="fa fa-flask"></i> 驴Para qu茅 sirve este procedimiento?</h3>
      <div class="info-box">
        <h5>Aplicaciones Cl铆nicas y de Investigaci贸n:</h5>
        <p><strong> Diagn贸stico:</strong> Identificar pat贸genos (virus, bacterias) o mutaciones gen茅ticas en muestras de pacientes</p>
        <p><strong>К Investigaci贸n Forense:</strong> An谩lisis de ADN en muestras de escenas de crimen</p>
        <p><strong> Gen茅tica Agr铆cola:</strong> Identificar organismos gen茅ticamente modificados (OGM)</p>
        <p><strong> Epidemiolog铆a:</strong> Caracterizar cepas de pat贸genos en brotes epidemiol贸gicos</p>
        <p><strong>锔 Medicina Personalizada:</strong> Detectar biomarcadores para tratamientos espec铆ficos</p>
      </div>
    </div>

    <!-- QU ES EL ADN -->
    <div class="mocap-section">
      <h3 style="color: #3498db; margin-bottom: 10px;"><i class="fa fa-helix"></i> 驴Qu茅 es el ADN?</h3>
      <div class="info-box adn">
        <h5 style="color: #3498db;">Estructura del ADN</h5>
        <p>El <strong>cido Desoxirribonucleico (ADN)</strong> es la mol茅cula que contiene toda la informaci贸n gen茅tica de un organismo.</p>
        <p><strong>Caracter铆stica principal:</strong> Doble h茅lice formada por dos cadenas de nucle贸tidos</p>
        <p><strong>Composici贸n:</strong> Bases nitrogenadas (Adenina, Timina, Guanina, Citosina)</p>
        <p><strong>Funci贸n biol贸gica:</strong> Almacena y transmite informaci贸n hereditaria</p>
      </div>
    </div>

    <!-- QU ES PCR -->
    <div class="mocap-section">
      <h3 style="color: #3498db; margin-bottom: 10px;"><i class="fa fa-flask"></i> 驴Qu茅 es PCR?</h3>
      <div class="info-box pcr">
        <h5 style="color: #e74c3c;">PCR (Polymerase Chain Reaction)</h5>
        <p><strong>Traducci贸n:</strong> Reacci贸n en Cadena de la Polimerasa</p>
        <p><strong>驴C贸mo funciona?</strong> Es una t茅cnica que amplifica millones de veces una secuencia espec铆fica de ADN en ciclos de tres pasos:</p>
        <p><strong>1锔 Desnaturalizaci贸n:</strong> El ADN se calienta a 94-95掳C para separar la doble h茅lice en dos cadenas simples</p>
        <p><strong>2锔 Alineamiento:</strong> Se enfr铆a a 50-65掳C para que los cebadores (primers) se unan a la secuencia objetivo</p>
        <p><strong>3锔 Extensi贸n:</strong> Se calienta a 72掳C para que la enzima ADN polimerasa copie la cadena</p>
        <p><strong>Resultado:</strong> Despu茅s de 25-35 ciclos, la secuencia original se multiplica por 2 elevado a n (millones de copias)</p>
      </div>
    </div>

    <!-- SIMULADOR -->
    <div class="mocap-section">
      <h3 style="color: #3498db; margin-bottom: 10px;"><i class="fa fa-play-circle"></i> Simulador Interactivo</h3>
      <label style="color: #2c3e50; font-weight: bold;">Selecciona el proceso a visualizar:</label>
      <div class="canvas-container">
        <select id="modo" style="width: 100%; max-width: 300px; padding: 10px; margin: 10px auto; display: block; border-radius: 8px;">
          <option value="adn"> ADN - Replicaci贸n Celular</option>
          <option value="pcr"> PCR - Amplificaci贸n por ciclos</option>
        </select>
        <canvas id="cv" width="800" height="320"></canvas>
        <div class="controls">
          <button onclick="start()"><i class="fa fa-play"></i> Iniciar</button>
          <button onclick="pause()"><i class="fa fa-pause"></i> Pausar</button>
          <button onclick="resetAnim()"><i class="fa fa-refresh"></i> Reiniciar</button>
        </div>
      </div>
    </div>

    <!-- DATOS DE TOMA.HTML -->
    <div class="mocap-section">
      <h3 style="color: #3498db; margin-bottom: 10px;"><i class="fa fa-flask"></i> Muestras Registradas en Laboratorio</h3>
      
      <!-- Estad铆sticas -->
      <div class="row mb-2">
        <div class="col-md-3 col-sm-6">
          <div class="card-muestra text-center">
            <h6><i class="fa fa-flask"></i> Total ADN</h6>
            <div style="font-size: 24px; color: #3498db; font-weight: bold;" id="total-adn">0</div>
          </div>
        </div>
        <div class="col-md-3 col-sm-6">
          <div class="card-muestra text-center">
            <h6><i class="fa fa-dna"></i> Total ARN</h6>
            <div style="font-size: 24px; color: #e74c3c; font-weight: bold;" id="total-arn">0</div>
          </div>
        </div>
        <div class="col-md-3 col-sm-6">
          <div class="card-muestra text-center">
            <h6><i class="fa fa-database"></i> Muestras Totales</h6>
            <div style="font-size: 24px; color: #3498db; font-weight: bold;" id="total-muestras">0</div>
          </div>
        </div>
        <div class="col-md-3 col-sm-6">
          <div class="card-muestra text-center">
            <h6><i class="fa fa-user"></i> Pacientes nicos</h6>
            <div style="font-size: 24px; color: #2ecc71; font-weight: bold;" id="pacientes-unicos">0</div>
          </div>
        </div>
      </div>

      <!-- Tablas de Muestras -->
      <div class="row">
        <div class="col-md-6">
          <h5 style="color: #3498db; margin-bottom: 8px;"><i class="fa fa-flask"></i> Muestras ADN</h5>
          <div class="table-responsive" id="tabla-adn-container">
            <p style="text-align: center; color: #999; font-size: 12px;">No hay muestras ADN registradas</p>
          </div>
        </div>
        <div class="col-md-6">
          <h5 style="color: #e74c3c; margin-bottom: 8px;"><i class="fa fa-dna"></i> Muestras ARN</h5>
          <div class="table-responsive" id="tabla-arn-container">
            <p style="text-align: center; color: #999; font-size: 12px;">No hay muestras ARN registradas</p>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script src="js/jquery-3.4.1.min.js"></script>
  <script src="js/bootstrap.js"></script>

  <script>
    // Variables globales para contar muestras
    let countADN = 0;
    let countARN = 0;

    // CARGAR DATOS DE TOMA.HTML
    function cargarDatos() {
      let registrosADN = JSON.parse(localStorage.getItem('registrosADN')) || [];
      let registrosARN = JSON.parse(localStorage.getItem('registrosARN')) || [];

      // Guardar conteos globales para usar en animaci贸n
      countADN = registrosADN.length;
      countARN = registrosARN.length;

      // Actualizar estad铆sticas
      $('#total-adn').text(registrosADN.length);
      $('#total-arn').text(registrosARN.length);
      $('#total-muestras').text(registrosADN.length + registrosARN.length);

      let pacientes = new Set();
      registrosADN.forEach(reg => pacientes.add(reg.doc));
      registrosARN.forEach(reg => pacientes.add(reg.doc));
      $('#pacientes-unicos').text(pacientes.size);

      // Renderizar tabla ADN
      if (registrosADN.length > 0) {
        let tablaADN = '<table class="table table-sm table-hover"><thead style="background: #3498db; color: white;"><tr><th>Nombre</th><th>Documento</th><th>Fecha</th></tr></thead><tbody>';
        registrosADN.forEach(reg => {
          tablaADN += `<tr><td>${reg.nombre}</td><td>${reg.doc}</td><td>${reg.fecha}</td></tr>`;
        });
        tablaADN += '</tbody></table>';
        $('#tabla-adn-container').html(tablaADN);
      }

      // Renderizar tabla ARN
      if (registrosARN.length > 0) {
        let tablaARN = '<table class="table table-sm table-hover"><thead style="background: #e74c3c; color: white;"><tr><th>Nombre</th><th>Documento</th><th>Fecha</th></tr></thead><tbody>';
        registrosARN.forEach(reg => {
          tablaARN += `<tr><td>${reg.nombre}</td><td>${reg.doc}</td><td>${reg.fecha}</td></tr>`;
        });
        tablaARN += '</tbody></table>';
        $('#tabla-arn-container').html(tablaARN);
      }
    }

    // Cargar datos al abrir la p谩gina y cada 2 segundos para actualizaci贸n en tiempo real
    $(document).ready(function() {
      cargarDatos();
      // Actualizar cada 2 segundos para reflejar cambios en tiempo real
      setInterval(cargarDatos, 2000);
    });

    // SIMULADOR ADN Y PCR
    const canvas = document.getElementById("cv");
    const ctx = canvas.getContext("2d");

    let x = 0;
    let running = false;
    let frame;

    // Dibujar doble h茅lice de ADN
    function drawDNAHelix(startX, startY, length, color) {
      const amplitude = 30;
      const frequency = 0.05;
      
      // Primera cadena
      ctx.strokeStyle = color;
      ctx.lineWidth = 3;
      ctx.beginPath();
      for (let i = 0; i < length; i += 2) {
        const y = startY + Math.sin(i * frequency) * amplitude;
        if (i === 0) ctx.moveTo(startX + i, y);
        else ctx.lineTo(startX + i, y);
      }
      ctx.stroke();

      // Segunda cadena
      ctx.beginPath();
      for (let i = 0; i < length; i += 2) {
        const y = startY + Math.sin(i * frequency + Math.PI) * amplitude;
        if (i === 0) ctx.moveTo(startX + i, y);
        else ctx.lineTo(startX + i, y);
      }
      ctx.stroke();

      // Enlaces entre cadenas
      ctx.strokeStyle = "rgba(" + (color === "#3498db" ? "52,152,219" : "199,125,255") + ",0.4)";
      ctx.lineWidth = 1;
      for (let i = 0; i < length; i += 15) {
        const y1 = startY + Math.sin(i * frequency) * amplitude;
        const y2 = startY + Math.sin(i * frequency + Math.PI) * amplitude;
        ctx.beginPath();
        ctx.moveTo(startX + i, y1);
        ctx.lineTo(startX + i, y2);
        ctx.stroke();
      }
    }

    // Nucle贸tidos con color
    function drawNucleotides(startX, startY, length, color) {
      const bases = ['A', 'T', 'G', 'C'];
      const colors = { 'A': '#FF6B6B', 'T': '#4ECDC4', 'G': '#95E1D3', 'C': '#FFE66D' };
      
      for (let i = 0; i < length; i += 30) {
        const y = startY + 15;
        ctx.fillStyle = colors[bases[Math.floor(i / 30) % 4]];
        ctx.beginPath();
        ctx.arc(startX + i, y, 6, 0, Math.PI * 2);
        ctx.fill();
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 1;
        ctx.stroke();
      }
    }

    // Polimerasa mejorada
    function drawPolymerase(x, y) {
      // Cuerpo principal
      ctx.fillStyle = '#27AE60';
      ctx.beginPath();
      ctx.ellipse(x, y, 25, 35, 0, 0, Math.PI * 2);
      ctx.fill();
      ctx.strokeStyle = '#1E8449';
      ctx.lineWidth = 3;
      ctx.stroke();

      // Pinza de agarre
      ctx.strokeStyle = '#1E8449';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.arc(x - 15, y - 10, 8, 0, Math.PI * 2);
      ctx.stroke();
      ctx.beginPath();
      ctx.arc(x + 15, y - 10, 8, 0, Math.PI * 2);
      ctx.stroke();

      // Centro activo
      ctx.fillStyle = '#F39C12';
      ctx.beginPath();
      ctx.arc(x, y + 5, 6, 0, Math.PI * 2);
      ctx.fill();
    }

    // Cebadores (Primers)
    function drawPrimer(x, y, length) {
      ctx.strokeStyle = '#9B59B6';
      ctx.lineWidth = 3;
      ctx.setLineDash([5, 5]);
      ctx.beginPath();
      ctx.moveTo(x, y);
      ctx.lineTo(x + length, y);
      ctx.stroke();
      ctx.setLineDash([]);

      ctx.fillStyle = '#9B59B6';
      ctx.font = 'bold 10px Arial';
      ctx.fillText('Primer', x, y - 5);
    }

    function drawADN(progress) {
      // Fondo con gradiente
      const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
      gradient.addColorStop(0, '#E8F4F8');
      gradient.addColorStop(1, '#D4E9F0');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // T铆tulo y info
      ctx.fillStyle = '#264653';
      ctx.font = 'bold 16px Arial';
      ctx.fillText('REPLICACIN DEL ADN', 50, 30);

      // Informaci贸n de muestras siendo procesadas
      ctx.fillStyle = '#d32f2f';
      ctx.font = 'bold 14px Arial';
      const currentColor = countADN > 5 ? '#d32f2f' : countADN > 3 ? '#f39c12' : '#27AE60';
      ctx.fillStyle = currentColor;
      ctx.fillText(`Procesando: ${countADN} muestras de ADN`, 50, 280);

      // Mostrar m煤ltiples cadenas basadas en cantidad de muestras
      const numCadenas = Math.min(countADN + 1, 3); // M谩ximo 3 cadenas visuales
      const spacing = 50;

      for (let cadena = 0; cadena < numCadenas; cadena++) {
        const startY = 70 + (cadena * spacing);
        
        // Color var铆a seg煤n cantidad
        let cadenaColor = '#3498db';
        if (countADN > 5) cadenaColor = '#e74c3c'; // Rojo si hay muchas
        else if (countADN > 3) cadenaColor = '#f39c12'; // Naranja si hay media

        drawDNAHelix(50, startY, progress, cadenaColor);
        
        // Nueva cadena siendo sintetizada
        ctx.fillStyle = '#1d3557';
        ctx.fillRect(50, startY + 55, progress, 15);
        if (progress > 50) drawPolymerase(50 + progress, startY + 62);
      }

      // Leyenda de colores
      ctx.fillStyle = '#555';
      ctx.font = '11px Arial';
      ctx.fillText('Verde: 1-3 muestras | Naranja: 4-5 muestras | Rojo: m谩s de 5 muestras', 50, 310);
    }

    function drawPCR(progress) {
      // Fondo con gradiente
      const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
      gradient.addColorStop(0, '#FFF5E6');
      gradient.addColorStop(1, '#FFE8CC');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // T铆tulo y info
      ctx.fillStyle = '#264653';
      ctx.font = 'bold 16px Arial';
      ctx.fillText('AMPLIFICACIN POR PCR', 50, 30);

      // Informaci贸n de muestras siendo procesadas
      const currentColor = countARN > 5 ? '#d32f2f' : countARN > 3 ? '#f39c12' : '#27AE60';
      ctx.fillStyle = currentColor;
      ctx.font = 'bold 12px Arial';
      ctx.fillText(`Procesando: ${countARN} muestras de ARN`, 50, 310);

      // Informaci贸n din谩mica de temperatura
      const cycleNum = Math.floor(progress / 200) + 1;
      const tempStep = progress % 200;
      let tempText = '';
      let tempValue = 25;

      if (tempStep < 66) {
        tempText = 'Desnaturalizaci贸n - 94-95掳C';
        tempValue = 94;
      } else if (tempStep < 133) {
        tempText = 'Alineamiento (Annealing) - 50-65掳C';
        tempValue = 57;
      } else {
        tempText = 'Extensi贸n - 72掳C';
        tempValue = 72;
      }

      ctx.fillStyle = currentColor;
      ctx.font = 'bold 13px Arial';
      ctx.fillText(`Ciclo: ${Math.min(cycleNum, 35)}  |  ${tempText}  |  ${tempValue}掳C`, 50, 280);

      // ADN original (molde) - solo se dibuja una vez
      let moldeColor = '#c77dff';
      if (countARN > 5) moldeColor = '#e74c3c';
      else if (countARN > 3) moldeColor = '#f39c12';

      drawDNAHelix(50, 70, 150, moldeColor);
      // Primer solo se dibuja una vez
      drawPrimer(50, 120, progress * 0.3);

      // S铆ntesis
      if (progress > 100) {
        ctx.fillStyle = '#1d3557';
        ctx.fillRect(50, 150, progress - 100, 20);
        drawPolymerase(50 + progress - 100, 160);
      }

      // Segunda parte de amplificaci贸n (m煤ltiples copias)
      const numCopias = Math.min(countARN, 2);
      for (let i = 0; i < numCopias; i++) {
        const yOffset = 70 + (i * 60);
        if (progress > 150) {
          drawDNAHelix(50 + (i * 120), yOffset, progress * 0.4, '#E74C3C');
        }
      }

      // Leyenda de colores
      ctx.fillStyle = '#555';
      ctx.font = '10px Arial';
      ctx.fillText('Verde: 1-3 muestras | Naranja: 4-5 muestras | Rojo: m谩s de 5 muestras', 50, 335);
    }

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      let modo = document.getElementById("modo").value;

      if (modo === "adn") {
        drawADN(x);
      } else {
        drawPCR(x);
      }

      if (running) {
        x += 3;
        if (x > 400) x = 400;
        frame = requestAnimationFrame(animate);
      }
    }

    function start() {
      if (!running) {
        running = true;
        animate();
      }
    }

    function pause() {
      running = false;
      cancelAnimationFrame(frame);
    }

    function resetAnim() {
      running = false;
      cancelAnimationFrame(frame);
      x = 0;
      animate();
    }

    animate();
  </script>

</body>
</html>
